---
// import FlechaIzquierda from "@/icons/FlechaIzquierda.astro";
import Layout from "@/layouts/Layout.astro";

if(Astro.locals.authUserId){
    return Astro.redirect(`/links/${Astro.locals.authUserId}`);
}
---

<Layout>
    <main class="flex flex-col items-center justify-center min-h-screen">
        <!-- <div class="w-[90%] max-w-xl mx-auto mb-4">
            <a href="/" class="text-slate-200 hover:text-slate-100 text-xl transition-colors flex items-center gap-2 hover:underline">
                <FlechaIzquierda />
                Inicio
            </a>
        </div> -->
        <form id="form" class="flex flex-col gap-4 w-[90%] max-w-xl mx-auto bg-white shadow-xl p-8 rounded-md">
            <h1 class="text-3xl font-bold text-slate-800 text-center mb-4">Iniciar sesión</h1>
            <p class="text-lg text-slate-600">Inicia sesión para crear y ver tus links</p>
            <div class="w-full text-slate-600">
                <label for="inputEmail" class="block mb-2">Email:</label>
                <input name="email" id="inputEmail" type="email" class="w-full p-2 border-2 border-slate-600 rounded-md" />
            </div>
            <div class="w-full text-slate-600">
                <label for="inputContrasena" class="block mb-2">Contraseña:</label>
                <input name="contrasena" id="inputContrasena" type="password" class="w-full p-2 border-2 border-slate-600 rounded-md" />
            </div>
            <button class="bg-slate-600 hover:bg-slate-500 text-white text-xl p-2 rounded-md transition-colors">
                Iniciar sesión
            </button>
        </form>
    </main>
</Layout>

<script>
    import { showToast } from "@/lib/toast";
    import { actions } from "astro:actions";

    const form = document.querySelector('#form') as HTMLFormElement;
    const inputEmail = document.querySelector('#inputEmail') as HTMLInputElement;

    form.addEventListener('submit', async e => {
        e.preventDefault();

        const formData = new FormData(form);

        let element = showToast({
            mensaje: "Iniciando sesión...",
            tipo: "info",
            promise: true
        });

        const { error, data } = await actions.iniciarSesion(formData);
        if(error){
            return showToast({
                elemento: element,
                mensaje: error.message || "Error al iniciar sesión",
                tipo: "error"
            });
        }
        if(data.correcta){
            window.location.href = new URLSearchParams(window.location.search).get("redirectTo") || "/";
            return;
        }
    });

    window.addEventListener("load", () => {
        inputEmail.focus();
    })
</script>